<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复 以下是整理的过程，分享给大家，如有问题欢迎大家指正~ 可加QQ群交流：4121914941、vertica备份1.1 vertica备份配置:12345678910111213141516171819202122232425262728[dbadmin@localhost ~]$">
<meta name="keywords" content="vertica">
<meta property="og:type" content="article">
<meta property="og:title" content="Vertica的这些事（十二）——-vertica备份与恢复">
<meta property="og:url" content="http://yoursite.com/2018/09/12/Vertica的这些事（十二）——-vertica备份与恢复/index.html">
<meta property="og:site_name" content="qinchaofeng的博客">
<meta property="og:description" content="最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复 以下是整理的过程，分享给大家，如有问题欢迎大家指正~ 可加QQ群交流：4121914941、vertica备份1.1 vertica备份配置:12345678910111213141516171819202122232425262728[dbadmin@localhost ~]$">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-09-12T04:54:25.217Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vertica的这些事（十二）——-vertica备份与恢复">
<meta name="twitter:description" content="最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复 以下是整理的过程，分享给大家，如有问题欢迎大家指正~ 可加QQ群交流：4121914941、vertica备份1.1 vertica备份配置:12345678910111213141516171819202122232425262728[dbadmin@localhost ~]$">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/09/12/Vertica的这些事（十二）——-vertica备份与恢复/"/>





  <title>Vertica的这些事（十二）——-vertica备份与恢复 | qinchaofeng的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">qinchaofeng的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">大数据实践者</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/12/Vertica的这些事（十二）——-vertica备份与恢复/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qinchaofeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/17826176?s=400&u=f462dc3827ab36e8a0421988cbf3e238926f496f&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qinchaofeng的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Vertica的这些事（十二）——-vertica备份与恢复</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-12T12:50:56+08:00">
                2018-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复-以下是整理的过程，分享给大家，如有问题欢迎大家指正-可加QQ群交流：412191494"><a href="#最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复-以下是整理的过程，分享给大家，如有问题欢迎大家指正-可加QQ群交流：412191494" class="headerlink" title="最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复 以下是整理的过程，分享给大家，如有问题欢迎大家指正~ 可加QQ群交流：412191494"></a>最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复 以下是整理的过程，分享给大家，如有问题欢迎大家指正~ 可加QQ群交流：412191494</h2><h2 id="1、vertica备份"><a href="#1、vertica备份" class="headerlink" title="1、vertica备份"></a>1、vertica备份</h2><h2 id="1-1-vertica备份配置"><a href="#1-1-vertica备份配置" class="headerlink" title="1.1 vertica备份配置:"></a>1.1 vertica备份配置:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py  --setupconfig</span><br><span class="line">Snapshot name (backup_snapshot): full_backup20160505</span><br><span class="line">Number of restore points (1): 1</span><br><span class="line">Specify objects (no default): </span><br><span class="line">Object restore mode (coexist, createOrReplace or create) (createOrReplace): </span><br><span class="line">Vertica user name (dbadmin): dbadmin</span><br><span class="line">Save password to avoid runtime prompt? (n) [y/n]: y</span><br><span class="line">Database user password to save in vbr password config file (no default):</span><br><span class="line">Node v_windy1990_node0001</span><br><span class="line">Backup host name (no default): 192.168.231.110</span><br><span class="line">Backup directory (no default): /home/dbadmin/backup</span><br><span class="line">Change advanced settings? (n) [y/n]: y</span><br><span class="line">Temp directory (/tmp/vbr): </span><br><span class="line">Number of times to retry (2): </span><br><span class="line">Seconds between retry attempts (1): </span><br><span class="line">Encrypt data during transmission? (n) [y/n]: </span><br><span class="line">Use checksum for data integrity (not file data and size)? (n) [y/n]: </span><br><span class="line">Port number for rsync daemon (50000): </span><br><span class="line">User name to access rsync daemon (no default): </span><br><span class="line">Password of the user who accesses rsync daemon:</span><br><span class="line">Backup transfer bandwidth limit in KBps or 0 for unlimited (0): </span><br><span class="line">Number of concurrency for backup (1): </span><br><span class="line">Restore transfer bandwidth limit in KBps or 0 for unlimited (0): </span><br><span class="line">Number of concurrency for restore (1): </span><br><span class="line">Password file name (no default): password</span><br><span class="line">Saved vbr password to password.</span><br><span class="line">Config file name (full_backup20160505.ini): </span><br><span class="line">Saved vbr config to full_backup20160505.ini.</span><br></pre></td></tr></table></figure>
<h2 id="备份成功后查看备份的文件内容如下："><a href="#备份成功后查看备份的文件内容如下：" class="headerlink" title="备份成功后查看备份的文件内容如下："></a>备份成功后查看备份的文件内容如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ more full_backup20160505.ini </span><br><span class="line">[Misc]</span><br><span class="line">snapshotName = full_backup20160505</span><br><span class="line">restorePointLimit = 1</span><br><span class="line">objectRestoreMode = createOrReplace</span><br><span class="line">tempDir = /tmp/vbr</span><br><span class="line">retryCount = 2</span><br><span class="line">retryDelay = 1</span><br><span class="line">passwordFile = password</span><br><span class="line"></span><br><span class="line">[Database]</span><br><span class="line">dbName = Windy1990</span><br><span class="line">dbUser = dbadmin</span><br><span class="line"></span><br><span class="line">[Transmission]</span><br><span class="line">encrypt = False</span><br><span class="line">checksum = False</span><br><span class="line">port_rsync = 50000</span><br><span class="line">serviceAccessUser = None</span><br><span class="line">total_bwlimit_backup = 0</span><br><span class="line">concurrency_backup = 1</span><br><span class="line">total_bwlimit_restore = 0</span><br><span class="line">concurrency_restore = 1</span><br><span class="line"></span><br><span class="line">[Mapping]</span><br><span class="line">v_windy1990_node0001 = 192.168.231.110:/home/dbadmin/backup</span><br></pre></td></tr></table></figure>
<h2 id="备份中我选了一个文件保存密码："><a href="#备份中我选了一个文件保存密码：" class="headerlink" title="备份中我选了一个文件保存密码："></a>备份中我选了一个文件保存密码：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/dbadmin/password</span><br></pre></td></tr></table></figure>
<h2 id="里面存有数据路的密码："><a href="#里面存有数据路的密码：" class="headerlink" title="里面存有数据路的密码："></a>里面存有数据路的密码：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ more password </span><br><span class="line">[Passwords]</span><br><span class="line">dbPassword = dbadmin</span><br><span class="line">1.2 vertica 全备份</span><br><span class="line">官方文档：</span><br><span class="line">A full backup is a complete copy of the database catalog, its schemas, tables, and other objects. It is a consistent image of the database at the time the backup occurred. You can use a full backup for disaster recovery to restore a damaged or incomplete database.</span><br></pre></td></tr></table></figure>
<h2 id="执行备份命令："><a href="#执行备份命令：" class="headerlink" title="执行备份命令："></a>执行备份命令：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task backup --config-file full_backup20160505.ini</span><br><span class="line">Error: Manifest not found at rsync://[192.168.231.110]:50000/home/dbadmin/backup/ -- is the backup location initialized? Hint: Execute &apos;--task init&apos; first.</span><br><span class="line">Backup FAILED.</span><br></pre></td></tr></table></figure>
<h2 id="发现报错了，根据提示，必须先初始化路径（个人理解的就是先声明路径）"><a href="#发现报错了，根据提示，必须先初始化路径（个人理解的就是先声明路径）" class="headerlink" title="发现报错了，根据提示，必须先初始化路径（个人理解的就是先声明路径）"></a>发现报错了，根据提示，必须先初始化路径（个人理解的就是先声明路径）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task init --config-file full_backup20160505.ini</span><br><span class="line">Initializing backup locations.</span><br><span class="line">Backup locations initialized.</span><br></pre></td></tr></table></figure>
<h2 id="路径声明成功！-查看该备份路径下多了一个文件。"><a href="#路径声明成功！-查看该备份路径下多了一个文件。" class="headerlink" title="路径声明成功！ 查看该备份路径下多了一个文件。"></a>路径声明成功！ 查看该备份路径下多了一个文件。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost backup]$ ls -l</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r--. 1 dbadmin verticadba 22 May  5 13:47 backup_manifest</span><br></pre></td></tr></table></figure>
<h2 id="然后再次执行备份命令："><a href="#然后再次执行备份命令：" class="headerlink" title="然后再次执行备份命令："></a>然后再次执行备份命令：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/vertica/bin/vbr.py --task backup --config-file full_backup20160505.ini</span><br></pre></td></tr></table></figure>
<h2 id="可以看到这次可以备份成功了："><a href="#可以看到这次可以备份成功了：" class="headerlink" title="可以看到这次可以备份成功了："></a>可以看到这次可以备份成功了：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task backup --config-file full_backup20160505.ini</span><br><span class="line">Starting backup of database Windy1990.</span><br><span class="line">Participating nodes: v_windy1990_node0001.</span><br><span class="line">Snapshotting database.</span><br><span class="line">Snapshot complete.</span><br><span class="line">Approximate bytes to copy: 60269241 of 60269241 total.</span><br><span class="line">[==================================================] 100%</span><br><span class="line">Copying backup metadata.</span><br><span class="line">Finalizing backup.</span><br><span class="line">Backup complete!</span><br></pre></td></tr></table></figure>
<h2 id="我们可以看到，已经完全备份了vertica数据库。-此时我们应该可以猜到，备份的数据存在我们刚刚声明的路径-home-dbamin-backup下："><a href="#我们可以看到，已经完全备份了vertica数据库。-此时我们应该可以猜到，备份的数据存在我们刚刚声明的路径-home-dbamin-backup下：" class="headerlink" title="我们可以看到，已经完全备份了vertica数据库。 此时我们应该可以猜到，备份的数据存在我们刚刚声明的路径/home/dbamin/backup下："></a>我们可以看到，已经完全备份了vertica数据库。 此时我们应该可以猜到，备份的数据存在我们刚刚声明的路径/home/dbamin/backup下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost backup]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r--. 1 dbadmin verticadba 1044 May  5 14:08 backup_manifest</span><br><span class="line">drwxr-xr-x. 8 dbadmin verticadba 4096 May  5 14:07 Objects</span><br><span class="line">drwxr-xr-x. 3 dbadmin verticadba 4096 May  5 14:08 Snapshots</span><br></pre></td></tr></table></figure>
<h2 id="可以看到多了2个文件夹-Objects-Snapshots-我们打开Objects文件夹可以看到，我们的vertica数据库文件就在该目录下。-home-dbadmin-backup-Snapshots-full-backup20160505-20160505-060600-v-windy1990-node0001目录下存放着我们备份的原vertica数据库的一下信息。"><a href="#可以看到多了2个文件夹-Objects-Snapshots-我们打开Objects文件夹可以看到，我们的vertica数据库文件就在该目录下。-home-dbadmin-backup-Snapshots-full-backup20160505-20160505-060600-v-windy1990-node0001目录下存放着我们备份的原vertica数据库的一下信息。" class="headerlink" title="可以看到多了2个文件夹 /Objects / Snapshots 我们打开Objects文件夹可以看到，我们的vertica数据库文件就在该目录下。 /home/dbadmin/backup/Snapshots/full_backup20160505_20160505_060600/v_windy1990_node0001目录下存放着我们备份的原vertica数据库的一下信息。"></a>可以看到多了2个文件夹 /Objects / Snapshots 我们打开Objects文件夹可以看到，我们的vertica数据库文件就在该目录下。 /home/dbadmin/backup/Snapshots/full_backup20160505_20160505_060600/v_windy1990_node0001目录下存放着我们备份的原vertica数据库的一下信息。</h2><h2 id="检查每个节点的数据流："><a href="#检查每个节点的数据流：" class="headerlink" title="检查每个节点的数据流："></a>检查每个节点的数据流：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select node_name,sum(used_bytes) as size_in_bytes from v_monitor.storage_containers group by node_name;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-vertica的增量备份-官方文档上是把全量和增量一起介绍的，称为Full-and-Incremental-Backups，在这里我把增量单独列了出来。-restorePointLimit控制着增量备份集的数量-我这只有一个节点，刚在配置备份文件的时候设置restorePointLimit-1-再次执行1-2中的全备份命令即可实现增量备份"><a href="#1-3-vertica的增量备份-官方文档上是把全量和增量一起介绍的，称为Full-and-Incremental-Backups，在这里我把增量单独列了出来。-restorePointLimit控制着增量备份集的数量-我这只有一个节点，刚在配置备份文件的时候设置restorePointLimit-1-再次执行1-2中的全备份命令即可实现增量备份" class="headerlink" title="1.3 vertica的增量备份 官方文档上是把全量和增量一起介绍的，称为Full and Incremental Backups，在这里我把增量单独列了出来。 restorePointLimit控制着增量备份集的数量 我这只有一个节点，刚在配置备份文件的时候设置restorePointLimit = 1 再次执行1.2中的全备份命令即可实现增量备份~"></a>1.3 vertica的增量备份 官方文档上是把全量和增量一起介绍的，称为Full and Incremental Backups，在这里我把增量单独列了出来。 restorePointLimit控制着增量备份集的数量 我这只有一个节点，刚在配置备份文件的时候设置restorePointLimit = 1 再次执行1.2中的全备份命令即可实现增量备份~</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task backup --config-file full_backup20160505.ini</span><br><span class="line">Starting backup of database Windy1990.</span><br><span class="line">Participating nodes: v_windy1990_node0001.</span><br><span class="line">Snapshotting database.</span><br><span class="line">Snapshot complete.</span><br><span class="line">Approximate bytes to copy: 0 of 60269241 total.</span><br><span class="line">[==================================================] 100%</span><br><span class="line">Copying backup metadata.</span><br><span class="line">Finalizing backup.</span><br><span class="line">Backup complete!</span><br></pre></td></tr></table></figure>
<h2 id="有人会问，我怎么知道这样就是增量备份而不是全量备份的呢？？-这个问题很好，我备份的时候也在想，备份完成后，我再次打开了backup文件夹，看到："><a href="#有人会问，我怎么知道这样就是增量备份而不是全量备份的呢？？-这个问题很好，我备份的时候也在想，备份完成后，我再次打开了backup文件夹，看到：" class="headerlink" title="有人会问，我怎么知道这样就是增量备份而不是全量备份的呢？？ 这个问题很好，我备份的时候也在想，备份完成后，我再次打开了backup文件夹，看到："></a>有人会问，我怎么知道这样就是增量备份而不是全量备份的呢？？ 这个问题很好，我备份的时候也在想，备份完成后，我再次打开了backup文件夹，看到：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ cd backup/</span><br><span class="line">[dbadmin@localhost backup]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r--. 1 dbadmin verticadba 1103 May  5 14:36 backup_manifest</span><br><span class="line">drwxr-xr-x. 8 dbadmin verticadba 4096 May  5 14:07 Objects</span><br><span class="line">drwxr-xr-x. 4 dbadmin verticadba 4096 May  5 14:36 Snapshots</span><br></pre></td></tr></table></figure>
<h2 id="大家看Objects目录的时间，因为在此过程中我没有对vertica数据库进行操作，所以vertica数据库文件还是原来的就没有更新。-所以想要知道上面我们操作的是增量的其实很简单，我在vertica数据库中的任意一张表中插入一条数据，然后我再执行上面的备份脚本。-我插入一条手机号："><a href="#大家看Objects目录的时间，因为在此过程中我没有对vertica数据库进行操作，所以vertica数据库文件还是原来的就没有更新。-所以想要知道上面我们操作的是增量的其实很简单，我在vertica数据库中的任意一张表中插入一条数据，然后我再执行上面的备份脚本。-我插入一条手机号：" class="headerlink" title="大家看Objects目录的时间，因为在此过程中我没有对vertica数据库进行操作，所以vertica数据库文件还是原来的就没有更新。 所以想要知道上面我们操作的是增量的其实很简单，我在vertica数据库中的任意一张表中插入一条数据，然后我再执行上面的备份脚本。 我插入一条手机号："></a>大家看Objects目录的时间，因为在此过程中我没有对vertica数据库进行操作，所以vertica数据库文件还是原来的就没有更新。 所以想要知道上面我们操作的是增量的其实很简单，我在vertica数据库中的任意一张表中插入一条数据，然后我再执行上面的备份脚本。 我插入一条手机号：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dbadmin=&gt; insert into tb_serv_num values(&apos;13488888888&apos;,&apos;qin**&apos;);</span><br><span class="line"> OUTPUT </span><br><span class="line">--------</span><br><span class="line">      1</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">dbadmin=&gt; commit;</span><br><span class="line">COMMIT</span><br><span class="line">dbadmin=&gt; \q</span><br></pre></td></tr></table></figure>
<h2 id="然后重新执行备份语句，执行后查看backup文件下的内容："><a href="#然后重新执行备份语句，执行后查看backup文件下的内容：" class="headerlink" title="然后重新执行备份语句，执行后查看backup文件下的内容："></a>然后重新执行备份语句，执行后查看backup文件下的内容：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ cd backup/</span><br><span class="line">[dbadmin@localhost backup]$ ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r--. 1 dbadmin verticadba 1171 May  5 14:46 backup_manifest</span><br><span class="line">drwxr-xr-x. 9 dbadmin verticadba 4096 May  5 14:46 Objects</span><br><span class="line">drwxr-xr-x. 4 dbadmin verticadba 4096 May  5 14:46 Snapshots</span><br></pre></td></tr></table></figure>
<h2 id="看文件时间，是不是说明我们上面的推理是正确的呢-所以，不要怀疑了，我们的增量备份是没有问题的！-1-4-vertica对象级备份-官网文档：-The-database-administrator-user-can-create-object-level-backups-consisting-of-one-or-more-schemas-and-tables-Object-level-backups-are-especially-useful-for-multi-tenanted-database-sites-其实对象级备份和全量备份差不多，知识在生成备份配置文件时有所不同（注意不同之处）："><a href="#看文件时间，是不是说明我们上面的推理是正确的呢-所以，不要怀疑了，我们的增量备份是没有问题的！-1-4-vertica对象级备份-官网文档：-The-database-administrator-user-can-create-object-level-backups-consisting-of-one-or-more-schemas-and-tables-Object-level-backups-are-especially-useful-for-multi-tenanted-database-sites-其实对象级备份和全量备份差不多，知识在生成备份配置文件时有所不同（注意不同之处）：" class="headerlink" title="看文件时间，是不是说明我们上面的推理是正确的呢~~~ 所以，不要怀疑了，我们的增量备份是没有问题的！ 1.4 vertica对象级备份 官网文档： The database administrator user can create object-level backups consisting of one or more schemas and tables. Object-level backups are especially useful for multi-tenanted database sites. 其实对象级备份和全量备份差不多，知识在生成备份配置文件时有所不同（注意不同之处）："></a>看文件时间，是不是说明我们上面的推理是正确的呢~~~ 所以，不要怀疑了，我们的增量备份是没有问题的！ 1.4 vertica对象级备份 官网文档： The database administrator user can create object-level backups consisting of one or more schemas and tables. Object-level backups are especially useful for multi-tenanted database sites. 其实对象级备份和全量备份差不多，知识在生成备份配置文件时有所不同（注意不同之处）：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --setupconfigSnapshot name (backup_snapshot): backup_object_tb_serv</span><br><span class="line">Number of restore points (1): </span><br><span class="line">Specify objects (no default): tb_serv_num</span><br><span class="line">Object restore mode (coexist, createOrReplace or create) (createOrReplace): </span><br><span class="line">Vertica user name (dbadmin): </span><br><span class="line">Save password to avoid runtime prompt? (n) [y/n]: y</span><br><span class="line">Database user password to save in vbr password config file (no default):</span><br><span class="line">Node v_windy1990_node0001</span><br><span class="line">Backup host name (no default): 192.168.231.110</span><br><span class="line">Backup directory (no default): /home/dbadmin/backup</span><br><span class="line">Change advanced settings? (n) [y/n]: </span><br><span class="line">Password file name (no default): password</span><br><span class="line">Saved vbr password to password.</span><br><span class="line">Config file name (backup_object_tb_serv.ini): </span><br><span class="line">Saved vbr config to backup_object_tb_serv.ini.</span><br></pre></td></tr></table></figure>
<h2 id="然后在执行备份命令："><a href="#然后在执行备份命令：" class="headerlink" title="然后在执行备份命令："></a>然后在执行备份命令：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task backup --config-file backup_object_tb_serv.ini </span><br><span class="line">Starting backup of database Windy1990.</span><br><span class="line">Objects: [&apos;tb_serv_num&apos;]</span><br><span class="line">Participating nodes: v_windy1990_node0001.</span><br><span class="line">Snapshotting database.</span><br><span class="line">Snapshot complete.</span><br><span class="line">Approximate bytes to copy: 0 of 244 total.</span><br><span class="line">[==================================================] 100%</span><br><span class="line">Copying backup metadata.</span><br><span class="line">Finalizing backup.</span><br><span class="line">Backup complete!</span><br></pre></td></tr></table></figure>
<h2 id="已备份完成-1-5-vertica-Hard-Link-Local备份-官方文档：-A-hard-link-local-backup-is-a-full-or-object-level-backup-consisting-of-a-complete-copy-of-the-database-catalog-and-a-set-of-hard-file-links-to-corresponding-data-files-直接修改全备份的配置文件即可，加上一行："><a href="#已备份完成-1-5-vertica-Hard-Link-Local备份-官方文档：-A-hard-link-local-backup-is-a-full-or-object-level-backup-consisting-of-a-complete-copy-of-the-database-catalog-and-a-set-of-hard-file-links-to-corresponding-data-files-直接修改全备份的配置文件即可，加上一行：" class="headerlink" title="已备份完成~~ 1.5 vertica Hard Link Local备份 官方文档： A hard link local backup is a full or object-level backup consisting of a complete copy of the database catalog, and a set of hard file links to corresponding data files. 直接修改全备份的配置文件即可，加上一行："></a>已备份完成~~ 1.5 vertica Hard Link Local备份 官方文档： A hard link local backup is a full or object-level backup consisting of a complete copy of the database catalog, and a set of hard file links to corresponding data files. 直接修改全备份的配置文件即可，加上一行：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Transmission]</span><br><span class="line">encrypt = False</span><br><span class="line">checksum = False</span><br><span class="line">port_rsync = 50000</span><br><span class="line">serviceAccessUser = None</span><br><span class="line">total_bwlimit_backup = 0</span><br><span class="line">concurrency_backup = 1</span><br><span class="line">total_bwlimit_restore = 0</span><br><span class="line">concurrency_restore = 1</span><br><span class="line">hardLinkLocal = True</span><br></pre></td></tr></table></figure>
<h2 id="然后还是执行备份命令："><a href="#然后还是执行备份命令：" class="headerlink" title="然后还是执行备份命令："></a>然后还是执行备份命令：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/opt/vertica/bin/vbr.py --task backup --config-file HardLinkLocal_backup20160505.ini</span><br><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task backup --config-file HardLinkLocal_backup20160505.ini </span><br><span class="line">Starting backup of database Windy1990.</span><br><span class="line">Participating nodes: v_windy1990_node0001.</span><br><span class="line">Snapshotting database.</span><br><span class="line">Snapshot complete.</span><br><span class="line">Approximate bytes to copy: 0 of 60269355 total.</span><br><span class="line">[==================================================] 100%</span><br><span class="line">Copying backup metadata.</span><br><span class="line">Finalizing backup.</span><br><span class="line">Backup complete!</span><br></pre></td></tr></table></figure>
<h2 id="1-6-查看备份-查看备份的内容："><a href="#1-6-查看备份-查看备份的内容：" class="headerlink" title="1.6 查看备份 查看备份的内容："></a>1.6 查看备份 查看备份的内容：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/opt/vertica/bin/vbr.py --task listbackup --config-file HardLinkLocal_backup20160505.ini</span><br><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task listbackup --config-file HardLinkLocal_backup20160505.ini </span><br><span class="line">backup                                epoch   objects   hosts(nodes)                            file_system_type  </span><br><span class="line">full_backup20160505_20160505_074850   16                v_windy1990_node0001(192.168.231.110)   [Linux]           </span><br><span class="line">full_backup20160505_20160505_064640   16                v_windy1990_node0001(192.168.231.110)   [Linux]</span><br></pre></td></tr></table></figure>
<h2 id="在vertica数据库中可以查询到备份的信息："><a href="#在vertica数据库中可以查询到备份的信息：" class="headerlink" title="在vertica数据库中可以查询到备份的信息："></a>在vertica数据库中可以查询到备份的信息：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dbadmin=&gt; select * from database_backups;</span><br><span class="line">       backup_timestamp        |      node_name       |     snapshot_name     | backup_epoch | node_count | file_system_type |   objects   </span><br><span class="line">-------------------------------+----------------------+-----------------------+--------------+------------+------------------+-------------</span><br><span class="line"> 2016-05-05 14:08:03.369797+08 | v_windy1990_node0001 | full_backup20160505   |           15 |          1 | [Linux]          | </span><br><span class="line"> 2016-05-05 14:36:39.496688+08 | v_windy1990_node0001 | full_backup20160505   |           15 |          1 | [Linux]          | </span><br><span class="line"> 2016-05-05 14:42:35.517465+08 | v_windy1990_node0001 | full_backup20160505   |           15 |          1 | [Linux]          | </span><br><span class="line"> 2016-05-05 14:44:43.043536+08 | v_windy1990_node0001 | full_backup20160505   |           15 |          1 | [Linux]          | </span><br><span class="line"> 2016-05-05 14:46:57.958863+08 | v_windy1990_node0001 | full_backup20160505   |           16 |          1 | [Linux]          | </span><br><span class="line"> 2016-05-05 15:03:19.580159+08 | v_windy1990_node0001 | backup_object_tb_serv |           16 |          1 | [Linux]          | tb_serv_num</span><br><span class="line"> 2016-05-05 15:50:53.143446+08 | v_windy1990_node0001 | full_backup20160505   |           16 |          1 | [Linux]          | </span><br><span class="line">(7 rows)</span><br></pre></td></tr></table></figure>
<h2 id="2、vertica恢复"><a href="#2、vertica恢复" class="headerlink" title="2、vertica恢复"></a>2、vertica恢复</h2><h2 id="2-1-vertica恢复"><a href="#2-1-vertica恢复" class="headerlink" title="2.1 vertica恢复"></a>2.1 vertica恢复</h2><h2 id="为了看到是恢复是有用的，再次我破坏一下数据，drop一个表，删除一条数据"><a href="#为了看到是恢复是有用的，再次我破坏一下数据，drop一个表，删除一条数据" class="headerlink" title="为了看到是恢复是有用的，再次我破坏一下数据，drop一个表，删除一条数据"></a>为了看到是恢复是有用的，再次我破坏一下数据，drop一个表，删除一条数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dbadmin=&gt; select * from tb_rp_st_user_day ;</span><br><span class="line"> serv_number | user_name </span><br><span class="line">-------------+-----------</span><br><span class="line">(0 rows)</span><br><span class="line"></span><br><span class="line">dbadmin=&gt; drop table tb_rp_st_user_day;</span><br><span class="line">DROP TABLE</span><br><span class="line"></span><br><span class="line">dbadmin=&gt; select * from tb_serv_num where name=&apos;ss&apos;;</span><br><span class="line">  serv_num   | name </span><br><span class="line">-------------+------</span><br><span class="line"> 186371***** | ss</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">dbadmin=&gt; delete from tb_serv_num where name=&apos;ss&apos;;</span><br><span class="line"> OUTPUT </span><br><span class="line">--------</span><br><span class="line">      1</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">dbadmin=&gt; commit;</span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure>
<h2 id="开始执行恢复命令："><a href="#开始执行恢复命令：" class="headerlink" title="开始执行恢复命令："></a>开始执行恢复命令：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/opt/vertica/bin/vbr.py --task restore --config-file full_backup20160505.ini</span><br><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task restore --config-file full_backup20160505.ini Error: Full database restore requires the nodes be DOWN.</span><br><span class="line">Restore FAILED.</span><br></pre></td></tr></table></figure>
<h2 id="报错啦-提示只有在vertica数据库down的状态下才能恢复……"><a href="#报错啦-提示只有在vertica数据库down的状态下才能恢复……" class="headerlink" title="报错啦~ 提示只有在vertica数据库down的状态下才能恢复……"></a>报错啦~ 提示只有在vertica数据库down的状态下才能恢复……</h2><h2 id="查看官方文档："><a href="#查看官方文档：" class="headerlink" title="查看官方文档："></a>查看官方文档：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">To restore a full database backup, you must ensure that:</span><br><span class="line">•	The database is down. You cannot restore a full backup when the database is running.</span><br><span class="line">•	All of the backup hosts are up and available.</span><br><span class="line">•	The backup directory exists and contains the backups from which to restore.</span><br><span class="line">•	The cluster to which you are restoring the backup has the same number of hosts as the one used to create the backup. The node names and the IP addresses must also be identical.</span><br><span class="line">•	The database you are restoring must already exist on the cluster to which you are restoring data. The database can be completely empty without any data or schema. As long as the database name matches the name in the backup, and all of the node names match the names of the nodes in the configuration file, you can restore to it.</span><br><span class="line">•	The user performing the restore is the database administrator.</span><br></pre></td></tr></table></figure>
<h2 id="所以此处，我们先尝试第二种恢复方式（对象级恢复）来恢复数据，刚刚我们同时对tb-serv-num表做了对象级备份："><a href="#所以此处，我们先尝试第二种恢复方式（对象级恢复）来恢复数据，刚刚我们同时对tb-serv-num表做了对象级备份：" class="headerlink" title="所以此处，我们先尝试第二种恢复方式（对象级恢复）来恢复数据，刚刚我们同时对tb_serv_num表做了对象级备份："></a>所以此处，我们先尝试第二种恢复方式（对象级恢复）来恢复数据，刚刚我们同时对tb_serv_num表做了对象级备份：</h2><h2 id="执行对象级恢复："><a href="#执行对象级恢复：" class="headerlink" title="执行对象级恢复："></a>执行对象级恢复：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/opt/vertica/bin/vbr.py --task restore --config-file backup_object_tb_serv.ini</span><br><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task restore --config-file backup_object_tb_serv.ini </span><br><span class="line">Starting object restore of database Windy1990.</span><br><span class="line">Participating nodes: v_windy1990_node0001.</span><br><span class="line">Objects to restore: tb_serv_num.</span><br><span class="line">Restoring from restore point: backup_object_tb_serv_20160505_070249</span><br><span class="line">Loading snapshot catalog from backup.</span><br><span class="line">Syncing data from backup to cluster nodes.</span><br><span class="line">[==================================================] 100%</span><br><span class="line">Finalizing restore.</span><br><span class="line">Restore complete!</span><br></pre></td></tr></table></figure>
<h2 id="OK-看到上面我们已经恢复成功了，那就登上vertica数据库验证一下数据是否恢复了。"><a href="#OK-看到上面我们已经恢复成功了，那就登上vertica数据库验证一下数据是否恢复了。" class="headerlink" title="OK~看到上面我们已经恢复成功了，那就登上vertica数据库验证一下数据是否恢复了。"></a>OK~看到上面我们已经恢复成功了，那就登上vertica数据库验证一下数据是否恢复了。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dbadmin=&gt; select * from tb_serv_num ;</span><br><span class="line">  serv_num   | name  </span><br><span class="line">-------------+-------</span><br><span class="line"> 138***** | windy</span><br><span class="line"> 186***** | ss</span><br><span class="line"> 134***** | qin**</span><br><span class="line">(3 rows)</span><br></pre></td></tr></table></figure>
<h2 id="可以看到，数据已恢复了-，等等，刚才我们还drop了一个-表，这个表是不是恢复了呢？"><a href="#可以看到，数据已恢复了-，等等，刚才我们还drop了一个-表，这个表是不是恢复了呢？" class="headerlink" title="可以看到，数据已恢复了~，等等，刚才我们还drop了一个 表，这个表是不是恢复了呢？"></a>可以看到，数据已恢复了~，等等，刚才我们还drop了一个 表，这个表是不是恢复了呢？</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dbadmin=&gt; \d tb_rp_st_user_day;</span><br><span class="line">Did not find any relation.</span><br></pre></td></tr></table></figure>
<h2 id="可以看到，表并没有恢复，为什么呢？-要知道我们此次恢复为对象级恢复，我们对象级备份是只备份了tb-serv-num表的数据而已，随意恢复也只能恢复该表的所有数据。-那么我们用第三种Hard-Link-Local方式恢复数据："><a href="#可以看到，表并没有恢复，为什么呢？-要知道我们此次恢复为对象级恢复，我们对象级备份是只备份了tb-serv-num表的数据而已，随意恢复也只能恢复该表的所有数据。-那么我们用第三种Hard-Link-Local方式恢复数据：" class="headerlink" title="可以看到，表并没有恢复，为什么呢？ 要知道我们此次恢复为对象级恢复，我们对象级备份是只备份了tb_serv_num表的数据而已，随意恢复也只能恢复该表的所有数据。 那么我们用第三种Hard Link Local方式恢复数据："></a>可以看到，表并没有恢复，为什么呢？ 要知道我们此次恢复为对象级恢复，我们对象级备份是只备份了tb_serv_num表的数据而已，随意恢复也只能恢复该表的所有数据。 那么我们用第三种Hard Link Local方式恢复数据：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/opt/vertica/bin/vbr.py --task restore --config-file HardLinkLocal_backup20160505.ini</span><br><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task restore --config-file HardLinkLocal_backup20160505.ini </span><br><span class="line">Error: Full database restore requires the nodes be DOWN.</span><br><span class="line">Restore FAILED.</span><br></pre></td></tr></table></figure>
<h2 id="同样看到，也需要vertica数据库为DOWN"><a href="#同样看到，也需要vertica数据库为DOWN" class="headerlink" title="同样看到，也需要vertica数据库为DOWN"></a>同样看到，也需要vertica数据库为DOWN</h2><p>看来要停掉vertica数据库了~（停掉数据库，此处略）<br>停掉vertica数据库后，再试全量恢复：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[dbadmin@localhost ~]$ /opt/vertica/bin/vbr.py --task restore --config-file full_backup20160505.ini </span><br><span class="line">Starting full restore of database Windy1990.</span><br><span class="line">Participating nodes: v_windy1990_node0001.</span><br><span class="line">Restoring from restore point: full_backup20160505_20160505_074850</span><br><span class="line">Computing the size of data to be synced from backup to cluster nodes.</span><br><span class="line">Syncing data from backup to cluster nodes.</span><br><span class="line">[==================================================] 100%</span><br><span class="line">Restoring catalog.</span><br><span class="line">Restore complete!</span><br></pre></td></tr></table></figure>
<p>可以看到，恢复的还不错。<br>再重新启动vertica，登上vertica后查看表tb_rp_st_user_day是否恢复了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dbadmin=&gt; \d tb_rp_st_user_day;</span><br><span class="line">                                            List of Fields by Tables</span><br><span class="line"> Schema |       Table       |   Column    |    Type     | Size | Default | Not Null | Primary Key | Foreign Key </span><br><span class="line">--------+-------------------+-------------+-------------+------+---------+----------+-------------+-------------</span><br><span class="line"> public | tb_rp_st_user_day | serv_number | varchar(13) |   13 |         | f        | f           | </span><br><span class="line"> public | tb_rp_st_user_day | user_name   | varchar(50) |   50 |         | f        | f           | </span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure>
<p>可以看到，恢复成功了。</p>
<p>以上就是vertica备份以及简单的恢复。</p>
<h2 id="通过此次vertica恢复可以看到，很多问题可以在官方文档中找到解决方法，在停掉vertica和启动时，遇到了一点问题，不过根据错误提示可以看出解决方法的。"><a href="#通过此次vertica恢复可以看到，很多问题可以在官方文档中找到解决方法，在停掉vertica和启动时，遇到了一点问题，不过根据错误提示可以看出解决方法的。" class="headerlink" title="通过此次vertica恢复可以看到，很多问题可以在官方文档中找到解决方法，在停掉vertica和启动时，遇到了一点问题，不过根据错误提示可以看出解决方法的。"></a>通过此次vertica恢复可以看到，很多问题可以在官方文档中找到解决方法，在停掉vertica和启动时，遇到了一点问题，不过根据错误提示可以看出解决方法的。</h2>
      
    </div>
    
    
    
    
    
    <div>
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------���Ľ���<i class="fa fa-paw"></i>��л�����Ķ�-------------</div>
    
</div>
    </div>
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/image/weixin.jpeg" alt="qinchaofeng wechat" style="width: 200px; max-width: 100%;"/>
    <div>������������~~</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>请我吃辣条吧~~</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wxpay.png" alt="qinchaofeng 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="qinchaofeng 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    qinchaofeng
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2018/09/12/Vertica的这些事（十二）——-vertica备份与恢复/" title="Vertica的这些事（十二）——-vertica备份与恢复">http://yoursite.com/2018/09/12/Vertica的这些事（十二）——-vertica备份与恢复/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/12/Vertica的这些事（十一）——-Vertica备份元数据信息/" rel="next" title="Vertica的这些事（十一）——-Vertica备份元数据信息">
                <i class="fa fa-chevron-left"></i> Vertica的这些事（十一）——-Vertica备份元数据信息
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/12/Vertica的这些事（十三）——Vertica备份元数据信息/" rel="prev" title="Vertica的这些事（十三）——Vertica备份元数据信息">
                Vertica的这些事（十三）——Vertica备份元数据信息 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars0.githubusercontent.com/u/17826176?s=400&u=f462dc3827ab36e8a0421988cbf3e238926f496f&v=4"
                alt="qinchaofeng" />
            
              <p class="site-author-name" itemprop="name">qinchaofeng</p>
              <p class="site-description motion-element" itemprop="description">大数据实践的那些事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/qinchaofeng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/qinchaofeng/activities" target="_blank" title="ZhiHu">
                      
                        <i class="fa fa-fw fa-globe"></i>ZhiHu</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.mdjs.info/" title="木东居士茶水间" target="_blank">木东居士茶水间</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复-以下是整理的过程，分享给大家，如有问题欢迎大家指正-可加QQ群交流：412191494"><span class="nav-number">1.</span> <span class="nav-text">最近在使用vertica，上网找了很多资料都没有，只有自己看官方文档动手搞一下了，今天搞了vertica的备份与恢复 以下是整理的过程，分享给大家，如有问题欢迎大家指正~ 可加QQ群交流：412191494</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1、vertica备份"><span class="nav-number">2.</span> <span class="nav-text">1、vertica备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-vertica备份配置"><span class="nav-number">3.</span> <span class="nav-text">1.1 vertica备份配置:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份成功后查看备份的文件内容如下："><span class="nav-number">4.</span> <span class="nav-text">备份成功后查看备份的文件内容如下：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份中我选了一个文件保存密码："><span class="nav-number">5.</span> <span class="nav-text">备份中我选了一个文件保存密码：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#里面存有数据路的密码："><span class="nav-number">6.</span> <span class="nav-text">里面存有数据路的密码：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行备份命令："><span class="nav-number">7.</span> <span class="nav-text">执行备份命令：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#发现报错了，根据提示，必须先初始化路径（个人理解的就是先声明路径）"><span class="nav-number">8.</span> <span class="nav-text">发现报错了，根据提示，必须先初始化路径（个人理解的就是先声明路径）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路径声明成功！-查看该备份路径下多了一个文件。"><span class="nav-number">9.</span> <span class="nav-text">路径声明成功！ 查看该备份路径下多了一个文件。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#然后再次执行备份命令："><span class="nav-number">10.</span> <span class="nav-text">然后再次执行备份命令：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以看到这次可以备份成功了："><span class="nav-number">11.</span> <span class="nav-text">可以看到这次可以备份成功了：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#我们可以看到，已经完全备份了vertica数据库。-此时我们应该可以猜到，备份的数据存在我们刚刚声明的路径-home-dbamin-backup下："><span class="nav-number">12.</span> <span class="nav-text">我们可以看到，已经完全备份了vertica数据库。 此时我们应该可以猜到，备份的数据存在我们刚刚声明的路径/home/dbamin/backup下：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以看到多了2个文件夹-Objects-Snapshots-我们打开Objects文件夹可以看到，我们的vertica数据库文件就在该目录下。-home-dbadmin-backup-Snapshots-full-backup20160505-20160505-060600-v-windy1990-node0001目录下存放着我们备份的原vertica数据库的一下信息。"><span class="nav-number">13.</span> <span class="nav-text">可以看到多了2个文件夹 /Objects / Snapshots 我们打开Objects文件夹可以看到，我们的vertica数据库文件就在该目录下。 /home/dbadmin/backup/Snapshots/full_backup20160505_20160505_060600/v_windy1990_node0001目录下存放着我们备份的原vertica数据库的一下信息。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检查每个节点的数据流："><span class="nav-number">14.</span> <span class="nav-text">检查每个节点的数据流：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-vertica的增量备份-官方文档上是把全量和增量一起介绍的，称为Full-and-Incremental-Backups，在这里我把增量单独列了出来。-restorePointLimit控制着增量备份集的数量-我这只有一个节点，刚在配置备份文件的时候设置restorePointLimit-1-再次执行1-2中的全备份命令即可实现增量备份"><span class="nav-number">15.</span> <span class="nav-text">1.3 vertica的增量备份 官方文档上是把全量和增量一起介绍的，称为Full and Incremental Backups，在这里我把增量单独列了出来。 restorePointLimit控制着增量备份集的数量 我这只有一个节点，刚在配置备份文件的时候设置restorePointLimit = 1 再次执行1.2中的全备份命令即可实现增量备份~</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#有人会问，我怎么知道这样就是增量备份而不是全量备份的呢？？-这个问题很好，我备份的时候也在想，备份完成后，我再次打开了backup文件夹，看到："><span class="nav-number">16.</span> <span class="nav-text">有人会问，我怎么知道这样就是增量备份而不是全量备份的呢？？ 这个问题很好，我备份的时候也在想，备份完成后，我再次打开了backup文件夹，看到：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#大家看Objects目录的时间，因为在此过程中我没有对vertica数据库进行操作，所以vertica数据库文件还是原来的就没有更新。-所以想要知道上面我们操作的是增量的其实很简单，我在vertica数据库中的任意一张表中插入一条数据，然后我再执行上面的备份脚本。-我插入一条手机号："><span class="nav-number">17.</span> <span class="nav-text">大家看Objects目录的时间，因为在此过程中我没有对vertica数据库进行操作，所以vertica数据库文件还是原来的就没有更新。 所以想要知道上面我们操作的是增量的其实很简单，我在vertica数据库中的任意一张表中插入一条数据，然后我再执行上面的备份脚本。 我插入一条手机号：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#然后重新执行备份语句，执行后查看backup文件下的内容："><span class="nav-number">18.</span> <span class="nav-text">然后重新执行备份语句，执行后查看backup文件下的内容：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#看文件时间，是不是说明我们上面的推理是正确的呢-所以，不要怀疑了，我们的增量备份是没有问题的！-1-4-vertica对象级备份-官网文档：-The-database-administrator-user-can-create-object-level-backups-consisting-of-one-or-more-schemas-and-tables-Object-level-backups-are-especially-useful-for-multi-tenanted-database-sites-其实对象级备份和全量备份差不多，知识在生成备份配置文件时有所不同（注意不同之处）："><span class="nav-number">19.</span> <span class="nav-text">看文件时间，是不是说明我们上面的推理是正确的呢~~~ 所以，不要怀疑了，我们的增量备份是没有问题的！ 1.4 vertica对象级备份 官网文档： The database administrator user can create object-level backups consisting of one or more schemas and tables. Object-level backups are especially useful for multi-tenanted database sites. 其实对象级备份和全量备份差不多，知识在生成备份配置文件时有所不同（注意不同之处）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#然后在执行备份命令："><span class="nav-number">20.</span> <span class="nav-text">然后在执行备份命令：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#已备份完成-1-5-vertica-Hard-Link-Local备份-官方文档：-A-hard-link-local-backup-is-a-full-or-object-level-backup-consisting-of-a-complete-copy-of-the-database-catalog-and-a-set-of-hard-file-links-to-corresponding-data-files-直接修改全备份的配置文件即可，加上一行："><span class="nav-number">21.</span> <span class="nav-text">已备份完成~~ 1.5 vertica Hard Link Local备份 官方文档： A hard link local backup is a full or object-level backup consisting of a complete copy of the database catalog, and a set of hard file links to corresponding data files. 直接修改全备份的配置文件即可，加上一行：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#然后还是执行备份命令："><span class="nav-number">22.</span> <span class="nav-text">然后还是执行备份命令：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-查看备份-查看备份的内容："><span class="nav-number">23.</span> <span class="nav-text">1.6 查看备份 查看备份的内容：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在vertica数据库中可以查询到备份的信息："><span class="nav-number">24.</span> <span class="nav-text">在vertica数据库中可以查询到备份的信息：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、vertica恢复"><span class="nav-number">25.</span> <span class="nav-text">2、vertica恢复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-vertica恢复"><span class="nav-number">26.</span> <span class="nav-text">2.1 vertica恢复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为了看到是恢复是有用的，再次我破坏一下数据，drop一个表，删除一条数据"><span class="nav-number">27.</span> <span class="nav-text">为了看到是恢复是有用的，再次我破坏一下数据，drop一个表，删除一条数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开始执行恢复命令："><span class="nav-number">28.</span> <span class="nav-text">开始执行恢复命令：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#报错啦-提示只有在vertica数据库down的状态下才能恢复……"><span class="nav-number">29.</span> <span class="nav-text">报错啦~ 提示只有在vertica数据库down的状态下才能恢复……</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看官方文档："><span class="nav-number">30.</span> <span class="nav-text">查看官方文档：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#所以此处，我们先尝试第二种恢复方式（对象级恢复）来恢复数据，刚刚我们同时对tb-serv-num表做了对象级备份："><span class="nav-number">31.</span> <span class="nav-text">所以此处，我们先尝试第二种恢复方式（对象级恢复）来恢复数据，刚刚我们同时对tb_serv_num表做了对象级备份：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行对象级恢复："><span class="nav-number">32.</span> <span class="nav-text">执行对象级恢复：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OK-看到上面我们已经恢复成功了，那就登上vertica数据库验证一下数据是否恢复了。"><span class="nav-number">33.</span> <span class="nav-text">OK~看到上面我们已经恢复成功了，那就登上vertica数据库验证一下数据是否恢复了。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以看到，数据已恢复了-，等等，刚才我们还drop了一个-表，这个表是不是恢复了呢？"><span class="nav-number">34.</span> <span class="nav-text">可以看到，数据已恢复了~，等等，刚才我们还drop了一个 表，这个表是不是恢复了呢？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以看到，表并没有恢复，为什么呢？-要知道我们此次恢复为对象级恢复，我们对象级备份是只备份了tb-serv-num表的数据而已，随意恢复也只能恢复该表的所有数据。-那么我们用第三种Hard-Link-Local方式恢复数据："><span class="nav-number">35.</span> <span class="nav-text">可以看到，表并没有恢复，为什么呢？ 要知道我们此次恢复为对象级恢复，我们对象级备份是只备份了tb_serv_num表的数据而已，随意恢复也只能恢复该表的所有数据。 那么我们用第三种Hard Link Local方式恢复数据：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#同样看到，也需要vertica数据库为DOWN"><span class="nav-number">36.</span> <span class="nav-text">同样看到，也需要vertica数据库为DOWN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过此次vertica恢复可以看到，很多问题可以在官方文档中找到解决方法，在停掉vertica和启动时，遇到了一点问题，不过根据错误提示可以看出解决方法的。"><span class="nav-number">37.</span> <span class="nav-text">通过此次vertica恢复可以看到，很多问题可以在官方文档中找到解决方法，在停掉vertica和启动时，遇到了一点问题，不过根据错误提示可以看出解决方法的。</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qinchaofeng</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

  
  <script type="text/javascript"
  color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  


</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/love.js"></script>